-- SERVER SCRIPT: วางใน ServerScriptService
-- ระบบดูดไอเทมจากผู้เล่นที่เลือกผ่าน GUI

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- สร้าง RemoteEvent สำหรับขโมยไอเทม
local remote = Instance.new("RemoteEvent")
remote.Name = "StealItemEvent"
remote.Parent = ReplicatedStorage

local function StealAllItems(targetPlayer, player)
    if not targetPlayer or not player then return end
    local sourceBackpack = targetPlayer:FindFirstChild("Backpack")
    local targetBackpack = player:FindFirstChild("Backpack")
    if sourceBackpack and targetBackpack then
        for _, item in ipairs(sourceBackpack:GetChildren()) do
            item.Parent = targetBackpack
        end
        print(player.Name.." ขโมยไอเทมทั้งหมดจาก "..targetPlayer.Name)
    end
end

remote.OnServerEvent:Connect(function(player, targetName)
    local targetPlayer = Players:FindFirstChild(targetName)
    if targetPlayer and player then
        StealAllItems(targetPlayer, player)
    end
end)

-- LOCAL SCRIPT: วางใน StarterGui
-- GUI สำหรับเลือกผู้เล่นในเซิฟเวอร์และกดดูดไอเทม

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

local remote = ReplicatedStorage:WaitForChild("StealItemEvent")

-- สร้าง GUI
local screen = Instance.new("ScreenGui")
screen.Name = "StealItemGui"
screen.Parent = LocalPlayer:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 280, 0, 300)
frame.Position = UDim2.new(0.5, -140, 0.5, -150)
frame.BackgroundColor3 = Color3.fromRGB(44,44,44)
frame.Active = true
frame.Draggable = true
frame.Parent = screen

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.Text = "เลือกผู้เล่นเพื่อดูดไอเทม"
title.Font = Enum.Font.GothamBold
title.TextSize = 24
title.TextColor3 = Color3.new(1,1,1)
title.Parent = frame

local playerList = Instance.new("ScrollingFrame")
playerList.Size = UDim2.new(1, -20, 1, -80)
playerList.Position = UDim2.new(0, 10, 0, 48)
playerList.BackgroundColor3 = Color3.fromRGB(30,30,30)
playerList.CanvasSize = UDim2.new(0,0,0,0)
playerList.ScrollBarThickness = 9
playerList.Parent = frame

local function refreshPlayerList()
    playerList:ClearAllChildren()
    local y = 0
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(1, -8, 0, 36)
            btn.Position = UDim2.new(0, 4, 0, y)
            btn.Text = p.Name
            btn.Font = Enum.Font.GothamBold
            btn.TextSize = 20
            btn.BackgroundColor3 = Color3.fromRGB(90,90,140)
            btn.TextColor3 = Color3.new(1,1,1)
            btn.Parent = playerList

            btn.MouseButton1Click:Connect(function()
                remote:FireServer(p.Name)
            end)
            y = y + 40
        end
    end
    playerList.CanvasSize = UDim2.new(0,0,0,y)
end

refreshPlayerList()
Players.PlayerAdded:Connect(refreshPlayerList)
Players.PlayerRemoving:Connect(refreshPlayerList)

local close = Instance.new("TextButton")
close.Size = UDim2.new(0, 36, 0, 36)
close.Position = UDim2.new(1, -40, 0, 4)
close.Text = "✕"
close.BackgroundColor3 = Color3.fromRGB(130,40,40)
close.TextColor3 = Color3.new(1,1,1)
close.Font = Enum.Font.GothamBold
close.TextSize = 20
close.Parent = frame
close.MouseButton1Click:Connect(function() screen:Destroy() end)
