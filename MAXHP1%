-- UNIVERSAL PROTECTION SCRIPT (รวมทุกฟีเจอร์: Anti-Stun, Anti-Knockback, Anti-Ragdoll, Anti-Freeze, Anti-Root, AutoEquip, Anti-Uneqiup, Anti-Inventory Block, Anti-Slow, ปลดบล็อกสลับอาวุธ Hotkey 1-9/MouseWheel, AutoRespawn)
-- วางใน LocalScript (StarterPlayerScripts หรือ PlayerGui)

local player = game.Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local NORMAL_WALKSPEED = 16
local NORMAL_JUMPPOWER = 50

-- =============== ANTI-DEBUFF UNIVERSAL =================
local function fixHumanoid(humanoid)
    if not humanoid then return end

    -- Anti-Stun, Anti-Ragdoll, Anti-Knockback, Anti-Root, Anti-Sit, Anti-PlatformStand
    spawn(function()
        while humanoid.Parent do
            if humanoid.PlatformStand then humanoid.PlatformStand = false end
            if humanoid.Sit then humanoid.Sit = false end
            if humanoid:GetState() == Enum.HumanoidStateType.Physics
            or humanoid:GetState() == Enum.HumanoidStateType.FallingDown
            or humanoid:GetState() == Enum.HumanoidStateType.Ragdoll
            or humanoid:GetState() == Enum.HumanoidStateType.Seated
            or humanoid:GetState() == Enum.HumanoidStateType.PlatformStanding then
                humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
            end
            wait(0.05)
        end
    end)
    -- Anti-Slow, Anti-Root, Anti-Freeze
    spawn(function()
        while humanoid.Parent do
            if humanoid.WalkSpeed < NORMAL_WALKSPEED then
                humanoid.WalkSpeed = NORMAL_WALKSPEED
            end
            if humanoid.JumpPower < NORMAL_JUMPPOWER then
                humanoid.JumpPower = NORMAL_JUMPPOWER
            end
            if humanoid.WalkSpeed > 100 then
                humanoid.WalkSpeed = NORMAL_WALKSPEED
            end
            wait(0.05)
        end
    end)
    -- Anti-Silence (คืน Tool หากโดนบังคับ unequip)
    local bp = player.Backpack
    humanoid.ChildRemoved:Connect(function(child)
        if child:IsA("Tool") then
            wait(0.1)
            if bp:FindFirstChild(child.Name) then
                bp[child.Name].Parent = player.Character
            end
        end
    end)
    -- กัน destroy tool (API อนุญาตเท่าที่ได้)
    bp.ChildRemoved:Connect(function(tool)
        wait(0.1)
        if tool and not bp:FindFirstChild(tool.Name) and not (player.Character and player.Character:FindFirstChild(tool.Name)) then
            tool.Parent = bp
        end
    end)
end

local function hookAll()
    local char = player.Character
    if not char then return end
    local human = char:FindFirstChildOfClass("Humanoid")
    if human then
        fixHumanoid(human)
    end
end
if player.Character then hookAll() end
player.CharacterAdded:Connect(hookAll)

-- =============== ANTI-SWITCH (Hotkey 1-9 + MouseWheel) ===============
-- ปลดบล็อกปุ่ม 1-9 สลับอาวุธ/Tool ทุกชนิด
UIS.InputBegan:Connect(function(input, gameProcessed)
    -- Hotkey 1-9
    if gameProcessed then
        local keyNum = tonumber(input.KeyCode.Name:match("(%d)"))
        if keyNum and keyNum >= 1 and keyNum <= 9 then
            local tools = {}
            for _, tool in ipairs(player.Backpack:GetChildren()) do
                if tool:IsA("Tool") then table.insert(tools, tool) end
            end
            local tool = tools[keyNum]
            if tool then
                tool.Parent = player.Character
            end
        end
    end
    -- MouseWheel
    if input.UserInputType == Enum.UserInputType.MouseWheel then
        local function getTools()
            local tools = {}
            for _, tool in ipairs(player.Backpack:GetChildren()) do
                if tool:IsA("Tool") then table.insert(tools, tool) end
            end
            return tools
        end
        local function equipNextTool()
            local tools = getTools()
            if #tools == 0 then return end
            local current = player.Character and player.Character:FindFirstChildOfClass("Tool")
            local idx = 1
            if current then
                for i, tool in ipairs(tools) do
                    if tool == current then
                        idx = i % #tools + 1
                        break
                    end
                end
            end
            tools[idx].Parent = player.Character
        end
        local function equipPreviousTool()
            local tools = getTools()
            if #tools == 0 then return end
            local current = player.Character and player.Character:FindFirstChildOfClass("Tool")
            local idx = #tools
            if current then
                for i, tool in ipairs(tools) do
                    if tool == current then
                        idx = (i-2) % #tools + 1
                        break
                    end
                end
            end
            tools[idx].Parent = player.Character
        end
        if input.Position.Z > 0 then
            equipNextTool()
        elseif input.Position.Z < 0 then
            equipPreviousTool()
        end
    end
end)

-- ป้องกันโดนบังคับ unequip/คืน Tool อัตโนมัติ
player.Backpack.ChildRemoved:Connect(function(tool)
    wait(0.1)
    if tool and not player.Character:FindFirstChild(tool.Name) and not player.Backpack:FindFirstChild(tool.Name) then
        tool.Parent = player.Backpack
    end
end)

player.Backpack.ChildAdded:Connect(function(tool)
    wait(0.1)
    if tool and player.Character and not player.Character:FindFirstChildOfClass("Tool") then
        tool.Parent = player.Character
    end
end)

-- =============== AUTO RESPAWN UNIVERSAL ===============
local function autoRespawnHook(char)
    local humanoid = char:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid.Died:Connect(function()
            wait(1)
            if player and player.Character == nil then
                player:LoadCharacter()
            end
        end)
    end
end
if player.Character then autoRespawnHook(player.Character) end
player.CharacterAdded:Connect(autoRespawnHook)

-- UNIVERSAL ANTI-KICK & ANTI-TELEPORT SCRIPT (For exploit/Executor only!)
-- ป้องกันการโดน Kick, Teleport, Shutdown (ฝั่ง Client เท่านั้น!)
-- ใช้กับ Synapse X, KRNL, หรือ Executor ที่รองรับ metatable hooking

-- ป้องกัน .Kick() (กันโดนไล่ออกจากเกมแบบพื้นฐาน)
local mt = getrawmetatable(game)
setreadonly(mt, false)
local old = mt.__namecall
mt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    if method == "Kick" or method == "kick" then
        return wait(9e9) -- ทำให้ Kick ไม่ทำงาน
    end
    return old(self, ...)
end)
game.Players.LocalPlayer.Kick = function() return wait(9e9) end -- กันการ kick ตรงจาก LocalPlayer

-- ป้องกัน TeleportService:Teleport() (กันโดนโยกเซิฟ/วาร์ปออก)
local TeleportService = game:GetService("TeleportService")
TeleportService.Teleport = function() end
TeleportService.TeleportToPlaceInstance = function() end
TeleportService.TeleportPartyAsync = function() end
TeleportService.TeleportInit = function() end

-- ป้องกัน Shutdown (บางกรณี)
if game.OnClose then
    game.OnClose = function() return false end
end

-- ป้องกัน Kick จาก CoreGui (บางเกมใช้วิธีนี้)
pcall(function()
    game:GetService("StarterGui"):SetCore("ResetButtonCallback", false)
end)

-- หมายเหตุ: 
-- Script นี้กันได้เฉพาะการ kick/teleport/shutdown ที่ถูกสั่งจากฝั่ง Client หรือ Remote ฝั่ง Server ที่ไม่ได้ hard kill session
-- ถ้า Server ปิดเกมจริงๆ หรือ Roblox update method ใหม่ จะกันไม่ได้ 100%
-- ใช้เพื่อการศึกษาหรือทดสอบเท่านั้น ห้ามใช้กับบัญชีหลัก เสี่ยงโดนแบน!
