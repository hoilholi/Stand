local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

-- Configuration
local KEYBIND = Enum.KeyCode.T

-- Debug function
local function debugPrint(message)
    print("[ScriptLauncher] " .. tostring(message))
end

-- Ensure script runs on client
if not Players.LocalPlayer then
    debugPrint("Script must run on client!")
    return
end

-- Wait for PlayerGui
local PlayerGui = Players.LocalPlayer:WaitForChild("PlayerGui", 10)
if not PlayerGui then
    debugPrint("PlayerGui not found!")
    return
end

-- Create ScreenGui
debugPrint("Creating ScreenGui...")
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false
ScreenGui.Name = "ScriptLauncherGUI"
ScreenGui.Enabled = true
ScreenGui.IgnoreGuiInset = true

-- Create Main Frame
local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 280, 0, 420)
Frame.Position = UDim2.new(0.5, -140, 0.5, -210)
Frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Frame.ClipsDescendants = true
Frame.Parent = ScreenGui

-- Add Rounded Corners
local FrameCorner = Instance.new("UICorner")
FrameCorner.CornerRadius = UDim.new(0, 12)
FrameCorner.Parent = Frame

-- Add Gradient
local FrameGradient = Instance.new("UIGradient")
FrameGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(35, 35, 35)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(50, 50, 50))
}
FrameGradient.Rotation = 45
FrameGradient.Parent = Frame

-- Create Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 36)
TitleBar.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = Frame

local TitleBarCorner = Instance.new("UICorner")
TitleBarCorner.CornerRadius = UDim.new(0, 12)
TitleBarCorner.Parent = TitleBar

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(0.7, 0, 1, 0)
Title.Position = UDim2.new(0.05, 0, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "Script Launcher"
Title.TextColor3 = Color3.fromRGB(220, 220, 220)
Title.TextSize = 22
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.TextYAlignment = Enum.TextYAlignment.Center
Title.Parent = TitleBar

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 32, 0, 32)
CloseButton.Position = UDim2.new(1, -40, 0, 2)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.Text = "✕"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 18
CloseButton.Font = Enum.Font.Gotham
CloseButton.Parent = TitleBar

local CloseButtonCorner = Instance.new("UICorner")
CloseButtonCorner.CornerRadius = UDim.new(0, 8)
CloseButtonCorner.Parent = CloseButton

-- Minimize Button
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Size = UDim2.new(0, 32, 0, 32)
MinimizeButton.Position = UDim2.new(1, -76, 0, 2)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(50, 150, 200)
MinimizeButton.Text = "−"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 18
MinimizeButton.Font = Enum.Font.Gotham
MinimizeButton.Parent = TitleBar

local MinimizeButtonCorner = Instance.new("UICorner")
MinimizeButtonCorner.CornerRadius = UDim.new(0, 8)
MinimizeButtonCorner.Parent = MinimizeButton

-- Scrolling Frame for Buttons
local ScrollFrame = Instance.new("ScrollingFrame")
ScrollFrame.Size = UDim2.new(1, -20, 1, -100)
ScrollFrame.Position = UDim2.new(0, 10, 0, 50)
ScrollFrame.BackgroundTransparency = 1
ScrollFrame.ScrollBarThickness = 6
ScrollFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
ScrollFrame.Parent = Frame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 8)
UIListLayout.Parent = ScrollFrame

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, -20, 0, 40)
StatusLabel.Position = UDim2.new(0, 10, 1, -45)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "Ready"
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.TextSize = 16
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.TextTransparency = 0.5
StatusLabel.Parent = Frame

-- Scripts Table
local scripts = {
    {name = "Special System GUI", url = "https://raw.githubusercontent.com/hoilholi/Stand/main/ThachaiWiyaSchool", color = Color3.fromRGB(90, 120, 255)},
    {name = "Anti System GUI", url = "https://raw.githubusercontent.com/hoilholi/Stand/main/AntiSystemGUI", color = Color3.fromRGB(80, 200, 120)},
    {name = "Teleport System GUI", url = "https://raw.githubusercontent.com/hoilholi/Stand/main/tp", color = Color3.fromRGB(180, 100, 255)},
    {name = "Aim locking System GUI", url = "https://raw.githubusercontent.com/hoilholi/Stand/main/AIMBOT", color = Color3.fromRGB(255, 100, 100)},
    {name = "System command", url = "https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source", color = Color3.fromRGB(255, 180, 80)},
    {name = "Invisible", url = "https://rawscripts.net/raw/Universal-Script-Invisible-script-20557", color = Color3.fromRGB(80, 200, 200)}
}

-- Tween Management
local activeTweens = {}

local function cancelTweens(instance)
    if activeTweens[instance] then
        for _, tween in pairs(activeTweens[instance]) do
            tween:Cancel()
        end
        activeTweens[instance] = nil
    end
end

local function playTween(instance, tweenInfo, properties)
    cancelTweens(instance)
    activeTweens[instance] = activeTweens[instance] or {}
    local tween = TweenService:Create(instance, tweenInfo, properties)
    table.insert(activeTweens[instance], tween)
    tween:Play()
    tween.Completed:Connect(function()
        if activeTweens[instance] then
            for i, t in ipairs(activeTweens[instance]) do
                if t == tween then
                    table.remove(activeTweens[instance], i)
                    break
                end
            end
        end
    end)
end

-- Status Message Queue
local statusQueue = {}
local isShowingStatus = false

local function showStatus(message, color)
    table.insert(statusQueue, {text = message, color = color})
    if not isShowingStatus then
        isShowingStatus = true
        local function processQueue()
            if #statusQueue > 0 then
                local status = statusQueue[1]
                StatusLabel.Text = status.text
                StatusLabel.TextColor3 = status.color
                playTween(StatusLabel, TweenInfo.new(0.2), {TextTransparency = 0})
                wait(3)
                playTween(StatusLabel, TweenInfo.new(0.5), {TextTransparency = 0.5})
                table.remove(statusQueue, 1)
                wait(0.5)
                processQueue()
            else
                isShowingStatus = false
            end
        end
        processQueue()
    end
end

-- Create Buttons
local function createButton(scriptData, index)
    debugPrint("Creating button: " .. scriptData.name)
    local Button = Instance.new("TextButton")
    Button.Size = UDim2.new(1, -10, 0, 40)
    Button.BackgroundColor3 = scriptData.color
    Button.Text = scriptData.name
    Button.TextColor3 = Color3.fromRGB(255, 255, 255)
    Button.TextSize = 18
    Button.Font = Enum.Font.Gotham
    Button.Parent = ScrollFrame

    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 8)
    ButtonCorner.Parent = Button

    -- Hover Effect
    local hoverConnection, leaveConnection
    hoverConnection = Button.MouseEnter:Connect(function()
        playTween(Button, TweenInfo.new(0.2), {
            BackgroundColor3 = scriptData.color:Lerp(Color3.fromRGB(255, 255, 255), 0.15),
            Size = UDim2.new(1, -8, 0, 42)
        })
    end)
    leaveConnection = Button.MouseLeave:Connect(function()
        playTween(Button, TweenInfo.new(0.2), {
            BackgroundColor3 = scriptData.color,
            Size = UDim2.new(1, -10, 0, 40)
        })
    end)

    -- Button Click
    local clickConnection
    clickConnection = Button.MouseButton1Click:Connect(function()
        showStatus("Executing " .. scriptData.name .. "...", Color3.fromRGB(200, 200, 200))
        local success, response = pcall(function()
            return game:HttpGet(scriptData.url)
        end)
        if not success then
            showStatus("Error: Failed to fetch " .. scriptData.name, Color3.fromRGB(255, 100, 100))
            debugPrint("Failed to fetch URL: " .. scriptData.url .. " | Error: " .. tostring(response))
            return
        end
        local success, errorMsg = pcall(function()
            loadstring(response)()
        end)
        if success then
            showStatus(scriptData.name .. " executed successfully!", Color3.fromRGB(100, 255, 100))
        else
            showStatus("Error: " .. tostring(errorMsg), Color3.fromRGB(255, 100, 100))
            debugPrint("Execution error for " .. scriptData.name .. ": " .. tostring(errorMsg))
        end
    end)

    -- Update Canvas Size
    ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, (index * 48) + 10)

    -- Clean up connections
    Button.AncestryChanged:Connect(function()
        if not Button:IsDescendantOf(game) then
            hoverConnection:Disconnect()
            leaveConnection:Disconnect()
            clickConnection:Disconnect()
        end
    end)
end

-- Create buttons with error handling
local success, errorMsg = pcall(function()
    for i, script in ipairs(scripts) do
        createButton(script, i)
    end
end)
if not success then
    debugPrint("Error creating buttons: " .. tostring(errorMsg))
end

-- Close Button Functionality
local closeConnection = CloseButton.MouseButton1Click:Connect(function()
    playTween(Frame, TweenInfo.new(0.3), {BackgroundTransparency = 1, Size = UDim2.new(0, 0, 0, 0)})
    wait(0.3)
    ScreenGui.Enabled = false
    debugPrint("GUI closed")
end)

-- Minimize/Maximize Functionality
local minimized = false
local minimizeConnection = MinimizeButton.MouseButton1Click:Connect(function()
    minimized = not minimized
    local targetSize = minimized and UDim2.new(0, 280, 0, 36) or UDim2.new(0, 280, 0, 420)
    playTween(Frame, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Size = targetSize})
    ScrollFrame.Visible = not minimized
    StatusLabel.Visible = not minimized
    MinimizeButton.Text = minimized and "+" or "−"
    debugPrint(minimized and "GUI minimized" or "GUI maximized")
end)

-- Keybind to Toggle GUI
local inputConnection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == KEYBIND then
        ScreenGui.Enabled = not ScreenGui.Enabled
        debugPrint(ScreenGui.Enabled and "GUI shown" or "GUI hidden")
        if ScreenGui.Enabled then
            playTween(Frame, TweenInfo.new(0.3), {BackgroundTransparency = 0, Size = UDim2.new(0, 280, 0, minimized and 36 or 420)})
        end
    end
end)

-- Clean up on GUI destruction
ScreenGui.AncestryChanged:Connect(function()
    if not ScreenGui:IsDescendantOf(game) then
        closeConnection:Disconnect()
        minimizeConnection:Disconnect()
        inputConnection:Disconnect()
        for instance, tweens in pairs(activeTweens) do
            for _, tween in ipairs(tweens) do
                tween:Cancel()
            end
        end
        activeTweens = {}
        debugPrint("GUI destroyed")
    end
end)

debugPrint("GUI initialized successfully")
