-- วางใน StarterPlayerScripts หรือ StarterGui

local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer

-- CONFIG STATE
local LOCK_DISTANCE = 200  -- ปรับค่าเริ่มต้นเป็น 200 ตามคำขอ
local minLockDistance, maxLockDistance = 10, math.huge
local HEAD_HITBOX_SIZE = 6  -- ปรับเริ่มต้นตามที่ขอ (หัว=6)
local BODY_HITBOX_SIZE = 2  -- ปรับเริ่มต้นตามที่ขอ (ตัว=2)
local MAX_HITBOX_SIZE = 50
local ZOOM_DISTANCE = 10  -- ระยะเริ่มต้นของการซูม
local MIN_ZOOM = 2  -- ระยะซูมใกล้สุด
local MAX_ZOOM = 20  -- ระยะซูมไกลสุด
local ZOOM_STEP = 1  -- ขั้นตอนการซูม

-- ขนาดปกติของ Hitbox
local DEFAULT_HEAD_SIZE = Vector3.new(2, 1, 1)
local DEFAULT_BODY_SIZE = Vector3.new(2, 2, 1)

-- ฟังก์ชันแปลง Enum.KeyCode เป็นตัวอักษร (แสดงใน GUI)
local function keyToString(key)
    return (key and tostring(key):gsub("Enum.KeyCode.", "")) or ""
end

------------------------------------------------------------------
-- HITBOX SECTION (ปรับขนาด Hitbox จริง)
------------------------------------------------------------------
-- ปรับขนาดจริงของ Head และ Body
local function setHitboxSizes(char, head, body)
    head = math.clamp(head, 0.01, MAX_HITBOX_SIZE)
    body = math.clamp(body, 0.01, MAX_HITBOX_SIZE)
    if char:FindFirstChild("Head") then
        local part = char.Head
        part.Size = Vector3.new(head, head, head)
        local mesh = part:FindFirstChildOfClass("SpecialMesh")
        if mesh then
            mesh.Scale = Vector3.new(1, 1, 1) -- รีเซ็ต scale เพื่อให้ขนาดสมจริง
        end
        -- ไม่ set CanCollide/Anchored, ปล่อยให้เซิร์ฟเวอร์ควบคุม
    end
    if char:FindFirstChild("HumanoidRootPart") then
        local part = char.HumanoidRootPart
        part.Size = Vector3.new(body, body, body)
    end
    for _, part in ipairs(char:GetChildren()) do
        if part:IsA("BasePart") and part.Name:find("Torso") then
            part.Size = Vector3.new(body, body, body)
        end
    end
end

local function resetHitboxSizes(char)
    if char:FindFirstChild("Head") then
        local part = char.Head
        part.Size = DEFAULT_HEAD_SIZE
        local mesh = part:FindFirstChildOfClass("SpecialMesh")
        if mesh then
            mesh.Scale = Vector3.new(1.25, 1.25, 1.25) -- ค่าเริ่มต้นทั่วไปสำหรับ Head mesh ใน Roblox
        end
    end
    if char:FindFirstChild("HumanoidRootPart") then
        local part = char.HumanoidRootPart
        part.Size = DEFAULT_BODY_SIZE
    end
    for _, part in ipairs(char:GetChildren()) do
        if part:IsA("BasePart") and part.Name:find("Torso") then
            part.Size = Vector3.new(2, 2, 1) -- ค่าเริ่มต้นสำหรับ Torso
        end
    end
end

local function updateAllHitboxes()
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character then
            setHitboxSizes(plr.Character, HEAD_HITBOX_SIZE, BODY_HITBOX_SIZE)
        end
    end
end

local function resetAllHitboxes()
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character then
            resetHitboxSizes(plr.Character)
        end
    end
    HEAD_HITBOX_SIZE = 6  -- รีเซ็ตเป็นค่าเริ่มต้นใหม่
    BODY_HITBOX_SIZE = 2
    headSizeBox.Text = tostring(HEAD_HITBOX_SIZE)
    bodySizeBox.Text = tostring(BODY_HITBOX_SIZE)
end

Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function(char)
        task.wait(0.2)
        setHitboxSizes(char, HEAD_HITBOX_SIZE, BODY_HITBOX_SIZE)
    end)
end)

for _, plr in ipairs(Players:GetPlayers()) do
    if plr ~= player and plr.Character then
        setHitboxSizes(plr.Character, HEAD_HITBOX_SIZE, BODY_HITBOX_SIZE)
    end
end

------------------------------------------------------------------
-- GUI SETUP (ปรับให้เรียบร้อยและเรียงหน้าใหม่ ไม่หลุดกรอบ, และย้ายไปตรงกลางจอ)
------------------------------------------------------------------
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "LockOnGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 240, 0, 350)  -- เพิ่มความกว้างและความสูงเพื่อรองรับปุ่มและช่อง
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)  -- ตำแหน่งตรงกลางจอ
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)  -- Anchor ที่ตรงกลาง
MainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)  -- สีดำ
MainFrame.BackgroundTransparency = 0
MainFrame.Active = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(50, 50, 50)  -- เส้นขอบเทาเข้ม
UIStroke.Transparency = 0
UIStroke.Thickness = 1
UIStroke.Parent = MainFrame

local DragBar = Instance.new("Frame")
DragBar.Size = UDim2.new(1, 0, 0, 20)
DragBar.Position = UDim2.new(0, 0, 0, 0)
DragBar.BackgroundColor3 = Color3.fromRGB(20, 20, 20)  -- เทาเข้ม
DragBar.Active = true
DragBar.Parent = MainFrame

local UICornerDrag = Instance.new("UICorner")
UICornerDrag.CornerRadius = UDim.new(0, 8)
UICornerDrag.Parent = DragBar

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -40, 1, 0)
Title.Position = UDim2.new(0, 8, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "LockOn Settings"
Title.TextColor3 = Color3.fromRGB(200, 200, 200)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 12
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = DragBar

local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Size = UDim2.new(0, 16, 0, 16)
MinimizeButton.Position = UDim2.new(1, -24, 0.5, -8)
MinimizeButton.Text = "-"
MinimizeButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MinimizeButton.TextColor3 = Color3.fromRGB(200, 200, 200)
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.TextSize = 14
MinimizeButton.Parent = DragBar

local UICornerMin = Instance.new("UICorner")
UICornerMin.CornerRadius = UDim.new(0, 4)
UICornerMin.Parent = MinimizeButton

local MiniButton = Instance.new("TextButton")
MiniButton.Size = UDim2.new(0, 30, 0, 30)
MiniButton.Position = UDim2.new(0.5, 0, 0.5, 0)  -- ตำแหน่งตรงกลางเมื่อมินิไทซ์
MiniButton.AnchorPoint = Vector2.new(0.5, 0.5)
MiniButton.Text = "☰"
MiniButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MiniButton.TextColor3 = Color3.fromRGB(200, 200, 200)
MiniButton.Font = Enum.Font.GothamBold
MiniButton.TextSize = 20
MiniButton.Visible = false
MiniButton.Parent = ScreenGui

local UICornerMini = Instance.new("UICorner")
UICornerMini.CornerRadius = UDim.new(0, 8)
UICornerMini.Parent = MiniButton

-- ปุ่มหลัก (เว้นระยะห่างสม่ำเสมอ)
local ToggleAutoLock = Instance.new("TextButton")
ToggleAutoLock.Size = UDim2.new(0, 200, 0, 24)
ToggleAutoLock.Position = UDim2.new(0, 20, 0, 30)
ToggleAutoLock.Text = "Auto-Lock: OFF"
ToggleAutoLock.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
ToggleAutoLock.TextColor3 = Color3.fromRGB(200, 200, 200)
ToggleAutoLock.Font = Enum.Font.GothamSemibold
ToggleAutoLock.TextSize = 12
ToggleAutoLock.Parent = MainFrame

local UICornerLock = Instance.new("UICorner")
UICornerLock.CornerRadius = UDim.new(0, 6)
UICornerLock.Parent = ToggleAutoLock

local ToggleAutoFire = Instance.new("TextButton")
ToggleAutoFire.Size = UDim2.new(0, 200, 0, 24)
ToggleAutoFire.Position = UDim2.new(0, 20, 0, 60)
ToggleAutoFire.Text = "Auto-Fire: OFF"
ToggleAutoFire.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
ToggleAutoFire.TextColor3 = Color3.fromRGB(200, 200, 200)
ToggleAutoFire.Font = Enum.Font.GothamSemibold
ToggleAutoFire.TextSize = 12
ToggleAutoFire.Parent = MainFrame

local UICornerFire = Instance.new("UICorner")
UICornerFire.CornerRadius = UDim.new(0, 6)
UICornerFire.Parent = ToggleAutoFire

local ToggleTeamCheck = Instance.new("TextButton")
ToggleTeamCheck.Size = UDim2.new(0, 200, 0, 24)
ToggleTeamCheck.Position = UDim2.new(0, 20, 0, 90)
ToggleTeamCheck.Text = "Team Check: ON"
ToggleTeamCheck.BackgroundColor3 = Color3.fromRGB(0, 100, 0)
ToggleTeamCheck.TextColor3 = Color3.fromRGB(200, 200, 200)
ToggleTeamCheck.Font = Enum.Font.GothamSemibold
ToggleTeamCheck.TextSize = 12
ToggleTeamCheck.Parent = MainFrame

local UICornerTeam = Instance.new("UICorner")
UICornerTeam.CornerRadius = UDim.new(0, 6)
UICornerTeam.Parent = ToggleTeamCheck

local ResetHitboxButton = Instance.new("TextButton")
ResetHitboxButton.Size = UDim2.new(0, 200, 0, 24)
ResetHitboxButton.Position = UDim2.new(0, 20, 0, 120)
ResetHitboxButton.Text = "Reset Hitboxes"
ResetHitboxButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
ResetHitboxButton.TextColor3 = Color3.fromRGB(200, 200, 200)
ResetHitboxButton.Font = Enum.Font.GothamSemibold
ResetHitboxButton.TextSize = 12
ResetHitboxButton.Parent = MainFrame

local UICornerReset = Instance.new("UICorner")
UICornerReset.CornerRadius = UDim.new(0, 6)
UICornerReset.Parent = ResetHitboxButton

-- Container สำหรับปุ่ม G I F S (กรอบสีขาวกับเส้นขอบดำ เอาสีขาวออก)
local ButtonContainer = Instance.new("Frame")
ButtonContainer.Size = UDim2.new(0, 200, 0, 24)
ButtonContainer.Position = UDim2.new(0, 20, 0, 150)
ButtonContainer.BackgroundColor3 = Color3.fromRGB(0, 0, 0)  -- เปลี่ยนเป็นสีดำแทนสีขาว
ButtonContainer.Parent = MainFrame

local UICornerContainer = Instance.new("UICorner")
UICornerContainer.CornerRadius = UDim.new(0, 6)
UICornerContainer.Parent = ButtonContainer

local UIStrokeContainer = Instance.new("UIStroke")
UIStrokeContainer.Color = Color3.fromRGB(0, 0, 0)  -- เส้นขอบดำ
UIStrokeContainer.Thickness = 1
UIStrokeContainer.Parent = ButtonContainer

-- ปุ่ม G I F S (เรียงแนวนอน ด้านล่างปุ่มหลัก กับสีใหม่: ดำ, และตัวอักษรสีขาวเต็ม)
local LoadPasteWareButton = Instance.new("TextButton")  -- G (ดำ)
LoadPasteWareButton.Size = UDim2.new(0, 40, 0, 24)
LoadPasteWareButton.Position = UDim2.new(0, 0, 0, 0)
LoadPasteWareButton.Text = "G"
LoadPasteWareButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)  -- ดำ
LoadPasteWareButton.TextColor3 = Color3.fromRGB(255, 255, 255)  -- ขาว
LoadPasteWareButton.Font = Enum.Font.GothamSemibold
LoadPasteWareButton.TextSize = 12
LoadPasteWareButton.Parent = ButtonContainer

local UICornerPasteWare = Instance.new("UICorner")
UICornerPasteWare.CornerRadius = UDim.new(0, 6)
UICornerPasteWare.Parent = LoadPasteWareButton

local LoadInvisibleScriptButton = Instance.new("TextButton")  -- I (ดำ)
LoadInvisibleScriptButton.Size = UDim2.new(0, 40, 0, 24)
LoadInvisibleScriptButton.Position = UDim2.new(0, 50, 0, 0)
LoadInvisibleScriptButton.Text = "I"
LoadInvisibleScriptButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)  -- ดำ
LoadInvisibleScriptButton.TextColor3 = Color3.fromRGB(255, 255, 255)  -- ขาว
LoadInvisibleScriptButton.Font = Enum.Font.GothamSemibold
LoadInvisibleScriptButton.TextSize = 12
LoadInvisibleScriptButton.Parent = ButtonContainer

local UICornerInvisible = Instance.new("UICorner")
UICornerInvisible.CornerRadius = UDim.new(0, 6)
UICornerInvisible.Parent = LoadInvisibleScriptButton

local LoadInfiniteYieldButton = Instance.new("TextButton")  -- F (ดำ)
LoadInfiniteYieldButton.Size = UDim2.new(0, 40, 0, 24)
LoadInfiniteYieldButton.Position = UDim2.new(0, 100, 0, 0)
LoadInfiniteYieldButton.Text = "F"
LoadInfiniteYieldButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)  -- ดำ
LoadInfiniteYieldButton.TextColor3 = Color3.fromRGB(255, 255, 255)  -- ขาว
LoadInfiniteYieldButton.Font = Enum.Font.GothamSemibold
LoadInfiniteYieldButton.TextSize = 12
LoadInfiniteYieldButton.Parent = ButtonContainer

local UICornerInfinite = Instance.new("UICorner")
UICornerInfinite.CornerRadius = UDim.new(0, 6)
UICornerInfinite.Parent = LoadInfiniteYieldButton

local LoadStandButton = Instance.new("TextButton")  -- S (ดำ)
LoadStandButton.Size = UDim2.new(0, 40, 0, 24)
LoadStandButton.Position = UDim2.new(0, 150, 0, 0)
LoadStandButton.Text = "S"
LoadStandButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)  -- ดำ
LoadStandButton.TextColor3 = Color3.fromRGB(255, 255, 255)  -- ขาว
LoadStandButton.Font = Enum.Font.GothamSemibold
LoadStandButton.TextSize = 12
LoadStandButton.Parent = ButtonContainer

local UICornerStand = Instance.new("UICorner")
UICornerStand.CornerRadius = UDim.new(0, 6)
UICornerStand.Parent = LoadStandButton

-- ช่อง input (ปรับตำแหน่งให้ต่ำลงเพื่อเว้นที่ให้ปุ่ม G I F S)
local distanceLabel = Instance.new("TextLabel")
distanceLabel.Size = UDim2.new(0, 80, 0, 20)
distanceLabel.Position = UDim2.new(0, 20, 0, 180)
distanceLabel.BackgroundTransparency = 1
distanceLabel.Text = "Lock Distance:"
distanceLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
distanceLabel.Font = Enum.Font.GothamSemibold
distanceLabel.TextSize = 10
distanceLabel.TextXAlignment = Enum.TextXAlignment.Left
distanceLabel.Parent = MainFrame

local distanceBox = Instance.new("TextBox")
distanceBox.Size = UDim2.new(0, 80, 0, 20)
distanceBox.Position = UDim2.new(0, 100, 0, 180)
distanceBox.Text = tostring(LOCK_DISTANCE)
distanceBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
distanceBox.TextColor3 = Color3.fromRGB(200, 200, 200)
distanceBox.Font = Enum.Font.Gotham
distanceBox.TextSize = 10
distanceBox.ClearTextOnFocus = false
distanceBox.Parent = MainFrame

local UICornerDist = Instance.new("UICorner")
UICornerDist.CornerRadius = UDim.new(0, 4)
UICornerDist.Parent = distanceBox

local headSizeLabel = Instance.new("TextLabel")
headSizeLabel.Size = UDim2.new(0, 80, 0, 20)
headSizeLabel.Position = UDim2.new(0, 20, 0, 205)
headSizeLabel.BackgroundTransparency = 1
headSizeLabel.Text = "Head Hitbox:"
headSizeLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
headSizeLabel.Font = Enum.Font.GothamSemibold
headSizeLabel.TextSize = 10
headSizeLabel.TextXAlignment = Enum.TextXAlignment.Left
headSizeLabel.Parent = MainFrame

local headSizeBox = Instance.new("TextBox")
headSizeBox.Size = UDim2.new(0, 80, 0, 20)
headSizeBox.Position = UDim2.new(0, 100, 0, 205)
headSizeBox.Text = tostring(HEAD_HITBOX_SIZE)
headSizeBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
headSizeBox.TextColor3 = Color3.fromRGB(200, 200, 200)
headSizeBox.Font = Enum.Font.Gotham
headSizeBox.TextSize = 10
headSizeBox.ClearTextOnFocus = false
headSizeBox.Parent = MainFrame

local UICornerHead = Instance.new("UICorner")
UICornerHead.CornerRadius = UDim.new(0, 4)
UICornerHead.Parent = headSizeBox

local bodySizeLabel = Instance.new("TextLabel")
bodySizeLabel.Size = UDim2.new(0, 80, 0, 20)
bodySizeLabel.Position = UDim2.new(0, 20, 0, 230)
bodySizeLabel.BackgroundTransparency = 1
bodySizeLabel.Text = "Body Hitbox:"
bodySizeLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
bodySizeLabel.Font = Enum.Font.GothamSemibold
bodySizeLabel.TextSize = 10
bodySizeLabel.TextXAlignment = Enum.TextXAlignment.Left
bodySizeLabel.Parent = MainFrame

local bodySizeBox = Instance.new("TextBox")
bodySizeBox.Size = UDim2.new(0, 80, 0, 20)
bodySizeBox.Position = UDim2.new(0, 100, 0, 230)
bodySizeBox.Text = tostring(BODY_HITBOX_SIZE)
bodySizeBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
bodySizeBox.TextColor3 = Color3.fromRGB(200, 200, 200)
bodySizeBox.Font = Enum.Font.Gotham
bodySizeBox.TextSize = 10
bodySizeBox.ClearTextOnFocus = false
bodySizeBox.Parent = MainFrame

local UICornerBody = Instance.new("UICorner")
UICornerBody.CornerRadius = UDim.new(0, 4)
UICornerBody.Parent = bodySizeBox

-- Label ล่างสุด (Locking)
local label = Instance.new("TextLabel")
label.Size = UDim2.new(1, -40, 0, 20)
label.Position = UDim2.new(0, 20, 0, 260)
label.Text = "Locking: -"
label.TextColor3 = Color3.fromRGB(200, 200, 200)
label.BackgroundTransparency = 1
label.TextStrokeTransparency = 0.6
label.Font = Enum.Font.Gotham
label.TextSize = 12
label.TextXAlignment = Enum.TextXAlignment.Left
label.Parent = MainFrame

------------------------------------------------------------------
-- LOGIC SECTION
------------------------------------------------------------------
local autoLockEnabled = false
local autoFireEnabled = false
local teamCheckEnabled = true
local target = nil
local FIRE_COOLDOWN = 0.15

local lastTargetHumanoid = nil
local lastTarget = nil

local function showKillPopup()
    local popup = Instance.new("TextLabel")
    popup.Size = UDim2.new(0, 150, 0, 60)
    popup.Position = UDim2.new(0.5, -75, 0.4, 0)
    popup.BackgroundTransparency = 1
    popup.Text = "KILL +1"
    popup.TextColor3 = Color3.fromRGB(255, 80, 80)
    popup.TextStrokeTransparency = 0.3
    popup.Font = Enum.Font.GothamBlack
    popup.TextSize = 48
    popup.Parent = ScreenGui

    local tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local goal = {Position = UDim2.new(0.5, -75, 0.3, 0), TextTransparency = 1, TextStrokeTransparency = 1}
    TweenService:Create(popup, tweenInfo, goal):Play()
    task.delay(1.1, function()
        popup:Destroy()
    end)
end

local function getFrontFacingTarget()
    local cam = workspace.CurrentCamera
    local camPos = cam.CFrame.Position
    local camLook = cam.CFrame.LookVector
    local best, bestDot, minDist = nil, -1, math.huge
    for _, other in ipairs(Players:GetPlayers()) do
        if other ~= player and other.Character and other.Character:FindFirstChild("HumanoidRootPart") then
            if not teamCheckEnabled or (not other.Team or not player.Team or other.Team ~= player.Team) then
                local humanoid = other.Character:FindFirstChildOfClass("Humanoid")
                if humanoid and humanoid.Health > 0 then
                    local hrp = other.Character.HumanoidRootPart
                    local toTarget = (hrp.Position - camPos)
                    local dist = toTarget.Magnitude
                    local dot = camLook:Dot(toTarget.Unit)
                    if dist <= LOCK_DISTANCE and dot > bestDot then
                        bestDot = dot
                        best = other
                        minDist = dist
                    elseif dist <= LOCK_DISTANCE and dot == bestDot and dist < minDist then
                        best = other
                        minDist = dist
                    end
                end
            end
        end
    end
    return best
end

local function moveCameraBehindTarget(target, zoomDistance)
    if not target or not target.Character or not target.Character:FindFirstChild("HumanoidRootPart") then return end
    local cam = workspace.CurrentCamera
    local hrp = target.Character.HumanoidRootPart
    local forward = hrp.CFrame.LookVector
    local camOffset = -forward * zoomDistance
    local camPos = hrp.Position + camOffset + Vector3.new(0, 2, 0)
    local lookAt = hrp.Position + Vector3.new(0, 2, 0)
    cam.CFrame = CFrame.new(camPos, lookAt)
end

local function fire()
    local shootRemote = ReplicatedStorage:FindFirstChild("Shoot")
    if shootRemote and shootRemote:IsA("RemoteEvent") then
        shootRemote:FireServer()
    else
        local tool = player.Character and player.Character:FindFirstChildOfClass("Tool")
        if tool then
            tool:Activate()
        end
    end
end

ToggleAutoLock.MouseButton1Click:Connect(function()
    autoLockEnabled = not autoLockEnabled
    ToggleAutoLock.Text = "Auto-Lock: " .. (autoLockEnabled and "ON" or "OFF")
    ToggleAutoLock.BackgroundColor3 = autoLockEnabled and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(40, 40, 40)
end)

ToggleAutoFire.MouseButton1Click:Connect(function()
    autoFireEnabled = not autoFireEnabled
    ToggleAutoFire.Text = "Auto-Fire: " .. (autoFireEnabled and "ON" or "OFF")
    ToggleAutoFire.BackgroundColor3 = autoFireEnabled and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(40, 40, 40)
end)

ToggleTeamCheck.MouseButton1Click:Connect(function()
    teamCheckEnabled = not teamCheckEnabled
    ToggleTeamCheck.Text = "Team Check: " .. (teamCheckEnabled and "ON" or "OFF")
    ToggleTeamCheck.BackgroundColor3 = teamCheckEnabled and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(40, 40, 40)
end)

ResetHitboxButton.MouseButton1Click:Connect(function()
    resetAllHitboxes()
end)

LoadPasteWareButton.MouseButton1Click:Connect(function()
    local success, err = pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/FakeAngles/PasteWare/refs/heads/main/PasteWare.lua"))()
    end)
    if success then
        game.StarterGui:SetCore("SendNotification", {
            Title = "PasteWare Loaded";
            Text = "Script loaded successfully!";
            Duration = 3;
        })
    else
        game.StarterGui:SetCore("SendNotification", {
            Title = "Error Loading PasteWare";
            Text = tostring(err);
            Duration = 5;
        })
    end
end)

LoadInvisibleScriptButton.MouseButton1Click:Connect(function()
    local success, err = pcall(function()
        loadstring(game:HttpGet("https://rawscripts.net/raw/Universal-Script-Invisible-script-20557"))()
    end)
    if success then
        game.StarterGui:SetCore("SendNotification", {
            Title = "Invisible Script Loaded";
            Text = "Script loaded successfully!";
            Duration = 3;
        })
    else
        game.StarterGui:SetCore("SendNotification", {
            Title = "Error Loading Invisible Script";
            Text = tostring(err);
            Duration = 5;
        })
    end
end)

LoadInfiniteYieldButton.MouseButton1Click:Connect(function()
    local success, err = pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()
    end)
    if success then
        game.StarterGui:SetCore("SendNotification", {
            Title = "Infinite Yield Loaded";
            Text = "Script loaded successfully!";
            Duration = 3;
        })
    else
        game.StarterGui:SetCore("SendNotification", {
            Title = "Error Loading Infinite Yield";
            Text = tostring(err);
            Duration = 5;
        })
    end
end)

LoadStandButton.MouseButton1Click:Connect(function()
    local success, err = pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/hoilholi/Stand/main/ThachaiWiyaSchool"))()
    end)
    if success then
        game.StarterGui:SetCore("SendNotification", {
            Title = "Stand Loaded";
            Text = "Script loaded successfully!";
            Duration = 3;
        })
    else
        game.StarterGui:SetCore("SendNotification", {
            Title = "Error Loading Stand";
            Text = tostring(err);
            Duration = 5;
        })
    end
end)

UserInputService.InputBegan:Connect(function(input, processed)
    if not processed and input.KeyCode == Enum.KeyCode.V then
        autoLockEnabled = not autoLockEnabled
        ToggleAutoLock.Text = "Auto-Lock: " .. (autoLockEnabled and "ON" or "OFF")
        ToggleAutoLock.BackgroundColor3 = autoLockEnabled and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(40, 40, 40)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseWheel and autoLockEnabled and target then
        if input.Position.Z > 0 then
            ZOOM_DISTANCE = math.max(MIN_ZOOM, ZOOM_DISTANCE - ZOOM_STEP)
        elseif input.Position.Z < 0 then
            ZOOM_DISTANCE = math.min(MAX_ZOOM, ZOOM_DISTANCE + ZOOM_STEP)
        end
    end
end)

local lastFire = 0
local function tryAutoFire()
    if autoFireEnabled and target then
        local now = tick()
        if now - lastFire > FIRE_COOLDOWN then
            fire()
            lastFire = now
        end
    end
end

if UserInputService.TouchEnabled then
    UserInputService.TouchStarted:Connect(function(input, processed)
        tryAutoFire()
    end)
else
    UserInputService.InputBegan:Connect(function(input, processed)
        if processed then return end
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            tryAutoFire()
        end
    end)
end

distanceBox.FocusLost:Connect(function()
    local val = tonumber(distanceBox.Text)
    if val then
        LOCK_DISTANCE = math.max(val, minLockDistance)
        distanceBox.Text = tostring(LOCK_DISTANCE)
    else
        distanceBox.Text = tostring(LOCK_DISTANCE)
    end
end)
headSizeBox.FocusLost:Connect(function()
    local val = tonumber(headSizeBox.Text)
    if val then
        HEAD_HITBOX_SIZE = math.clamp(val, 0.01, MAX_HITBOX_SIZE)
        headSizeBox.Text = tostring(HEAD_HITBOX_SIZE)
        updateAllHitboxes()
    else
        headSizeBox.Text = tostring(HEAD_HITBOX_SIZE)
    end
end)
bodySizeBox.FocusLost:Connect(function()
    local val = tonumber(bodySizeBox.Text)
    if val then
        BODY_HITBOX_SIZE = math.clamp(val, 0.01, MAX_HITBOX_SIZE)
        bodySizeBox.Text = tostring(BODY_HITBOX_SIZE)
        updateAllHitboxes()
    else
        bodySizeBox.Text = tostring(BODY_HITBOX_SIZE)
    end
end)

MinimizeButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    MiniButton.Visible = true
    MiniButton.Position = MainFrame.Position
end)
MiniButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = true
    MiniButton.Visible = false
end)

do
    local dragging, dragInput, dragStart, startPos
    local function update(input)
        if dragging then
            local viewport = workspace.CurrentCamera and workspace.CurrentCamera.ViewportSize or Vector2.new(1920,1080)
            local frameSize = MainFrame.AbsoluteSize
            local delta = input.Position - dragStart
            local newX = math.clamp(startPos.X + delta.X, 0, math.max(0, viewport.X - frameSize.X))
            local newY = math.clamp(startPos.Y + delta.Y, 0, math.max(0, viewport.Y - frameSize.Y))
            MainFrame.Position = UDim2.new(0, newX, 0, newY)
            if MiniButton.Visible then
                MiniButton.Position = MainFrame.Position
            end
        end
    end
    DragBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.AbsolutePosition
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    DragBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

task.spawn(function()
    while true do
        updateAllHitboxes()
        task.wait(1)
    end
end)

RunService.RenderStepped:Connect(function()
    if autoLockEnabled then
        local newTarget = getFrontFacingTarget()
        if newTarget ~= target then
            target = newTarget
            ZOOM_DISTANCE = 10
        end
        if target then
            moveCameraBehindTarget(target, ZOOM_DISTANCE)
            label.Text = "Locking: " .. target.Name .. " (Zoom: " .. ZOOM_DISTANCE .. "u)"

            local humanoid = target.Character and target.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                if lastTarget ~= target then
                    lastTarget = target
                    lastTargetHumanoid = humanoid
                end
                if lastTargetHumanoid and lastTargetHumanoid.Health == 0 then
                    showKillPopup()
                    lastTargetHumanoid = nil
                    lastTarget = nil
                end
            end
        else
            label.Text = "Locking: -"
            lastTarget = nil
            lastTargetHumanoid = nil
        end
    else
        target = nil
        label.Text = "Locking: -"
        lastTarget = nil
        lastTargetHumanoid = nil
    end
    if autoFireEnabled then
        tryAutoFire()
    end
end)
