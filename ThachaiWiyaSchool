-- เพิ่มฟีเจอร์ "ล่องหน" และ "ซ่อน Hitbox" (Invisible & Hide Hitbox)
-- ปุ่มใน GUI: 'ล่องหน/Uninvisible' และ 'ซ่อน Hitbox/คืน Hitbox'
-- สามารถผูกปุ่ม Hotkey เพิ่มได้ถ้าต้องการ
-- นำไปแทรกต่อท้าย GUI หลัก หรือใช้งานเดี่ยวๆ ก็ได้

-- สมมติว่าตัวแปร frame ยังอยู่ (GUI หลัก) ถ้าไม่มีให้ปรับเป็น screenGui แทน

local player = game.Players.LocalPlayer

-- ปุ่มล่องหน
local invisBtn = Instance.new("TextButton", frame)
invisBtn.Size = UDim2.new(0.28, -8, 0, 28)
invisBtn.Position = UDim2.new(0, 14, 0, frame.AbsoluteSize.Y-94)
invisBtn.Text = "ล่องหน"
invisBtn.Font = Enum.Font.GothamBold
invisBtn.TextSize = 14
invisBtn.BackgroundColor3 = Color3.fromRGB(160, 160, 255)
invisBtn.TextColor3 = Color3.new(0.1,0.1,0.2)
invisBtn.AutoButtonColor = true

-- ปุ่มซ่อน hitbox
local hitboxBtn = Instance.new("TextButton", frame)
hitboxBtn.Size = UDim2.new(0.28, -8, 0, 28)
hitboxBtn.Position = UDim2.new(0.3, 16, 0, frame.AbsoluteSize.Y-94)
hitboxBtn.Text = "ซ่อน Hitbox"
hitboxBtn.Font = Enum.Font.GothamBold
hitboxBtn.TextSize = 14
hitboxBtn.BackgroundColor3 = Color3.fromRGB(255, 170, 170)
hitboxBtn.TextColor3 = Color3.new(0.2,0.1,0.1)
hitboxBtn.AutoButtonColor = true

-- สถานะ
local isInvisible = false
local isHitboxHidden = false
local savedTransparency = {}
local savedCanCollide = {}

-- ฟังก์ชันล่องหน
local function setInvisible(state)
    local char = player.Character
    if not char then return end
    isInvisible = state
    for _,v in ipairs(char:GetDescendants()) do
        if v:IsA("BasePart") and v.Name ~= "HumanoidRootPart" then
            if state then
                savedTransparency[v] = v.Transparency
                v.Transparency = 1
                if v:FindFirstChildOfClass("Decal") then
                    for _,d in ipairs(v:GetChildren()) do
                        if d:IsA("Decal") then d.Transparency = 1 end
                    end
                end
            else
                v.Transparency = savedTransparency[v] or 0
                if v:FindFirstChildOfClass("Decal") then
                    for _,d in ipairs(v:GetChildren()) do
                        if d:IsA("Decal") then d.Transparency = 0 end
                    end
                end
            end
        end
    end
    if char:FindFirstChild("Head") and char.Head:FindFirstChild("face") then
        char.Head.face.Transparency = state and 1 or 0
    end
    -- สำหรับ Accessory
    for _,v in ipairs(char:GetChildren()) do
        if v:IsA("Accessory") and v:FindFirstChild("Handle") then
            v.Handle.Transparency = state and 1 or 0
        end
    end
    invisBtn.Text = state and "Uninvisible" or "ล่องหน"
    invisBtn.BackgroundColor3 = state and Color3.fromRGB(100,220,180) or Color3.fromRGB(160,160,255)
end

-- ฟังก์ชันซ่อน hitbox (ปิด CanCollide และขนาด 0.2)
local function setHideHitbox(state)
    local char = player.Character
    if not char then return end
    isHitboxHidden = state
    for _,v in ipairs(char:GetDescendants()) do
        if v:IsA("BasePart") and v.Name ~= "HumanoidRootPart" then
            if state then
                savedCanCollide[v] = v.CanCollide
                v.CanCollide = false
                v.Size = Vector3.new(0.2,0.2,0.2)
            else
                v.CanCollide = savedCanCollide[v] or true
                v.Size = v.Size.Magnitude < 0.3 and Vector3.new(2,2,1) or v.Size -- รีไซส์เป็นค่าเดิมคร่าวๆ (ถ้าอยากเก็บไซส์จริงต้องเซฟไว้เพิ่ม)
            end
        end
    end
    hitboxBtn.Text = state and "คืน Hitbox" or "ซ่อน Hitbox"
    hitboxBtn.BackgroundColor3 = state and Color3.fromRGB(100,220,180) or Color3.fromRGB(255,170,170)
end

-- ปุ่มกดใช้งาน
invisBtn.MouseButton1Click:Connect(function()
    setInvisible(not isInvisible)
end)
hitboxBtn.MouseButton1Click:Connect(function()
    setHideHitbox(not isHitboxHidden)
end)

-- ฟื้นคืนเมื่อรีเซ็ตตัวละคร
player.CharacterAdded:Connect(function(char)
    wait(0.3)
    if isInvisible then setInvisible(true) end
    if isHitboxHidden then setHideHitbox(true) end
end)

-- (ถ้าอยากเพิ่ม Hotkey ให้เพิ่มใน UIS.InputBegan ได้ เช่น I สำหรับล่องหน, H สำหรับ Hitbox)

-- ตัวอย่าง hotkey (ใส่ใน handler เดิม)
local UIS = game:GetService("UserInputService")
UIS.InputBegan:Connect(function(input, processed)
    if processed then return end
    -- เพิ่ม hotkey กำหนดเองที่นี่ (เช่น I=Invisible, H=HideHitbox)
    if input.KeyCode == Enum.KeyCode.I then invisBtn:Activate() end
    if input.KeyCode == Enum.KeyCode.H then hitboxBtn:Activate() end
end)
