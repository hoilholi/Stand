-- วางใน LocalScript (StarterPlayerScripts หรือ StarterCharacterScripts)

local player = game.Players.LocalPlayer
local teleportPosition = nil

-- GUI สร้างเองแบบง่าย
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "SavePointGUI"
local button = Instance.new("TextButton", screenGui)
button.Size = UDim2.new(0,150,0,50)
button.Position = UDim2.new(0,20,0,100)
button.Text = "Save Point"

-- ฟังก์ชันสำหรับเซฟพิกัด
button.MouseButton1Click:Connect(function()
	local char = player.Character
	if char and char:FindFirstChild("HumanoidRootPart") then
		teleportPosition = char.HumanoidRootPart.Position
		button.Text = "Saved!"
		wait(1)
		button.Text = "Save Point"
	end
end)

-- ฟังก์ชันสำหรับเช็ค HP และวาปกลับ
local function setupAutoTeleport(humanoid)
	humanoid.HealthChanged:Connect(function(health)
		if teleportPosition and (health/humanoid.MaxHealth) <= 0.15 and health > 0 then
			local char = player.Character
			if char and char:FindFirstChild("HumanoidRootPart") then
				char.HumanoidRootPart.CFrame = CFrame.new(teleportPosition)
			end
		end
	end)
end

player.CharacterAdded:Connect(function(char)
	local hum = char:WaitForChild("Humanoid")
	setupAutoTeleport(hum)
end)

-- เผื่อผู้เล่น spawn อยู่แล้ว
if player.Character and player.Character:FindFirstChild("Humanoid") then
	setupAutoTeleport(player.Character.Humanoid)
end
